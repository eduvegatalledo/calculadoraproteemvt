<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ProteeMVT — Calculadora & Registro de Macros</title>
  <meta name="description" content="Calcula tus macros, registra tus comidas y mide tu avance con una experiencia rápida y confiable." />
  <meta name="color-scheme" content="light" />
  <meta name="theme-color" content="#10b981" />
  <meta property="og:title" content="ProteeMVT — Calculadora & Registro de Macros" />
  <meta property="og:description" content="Calcula tus macros, guarda tus metas y registra tus comidas con una experiencia rápida, accesible y confiable." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="/og-preview.png" />
  <meta property="og:locale" content="es_ES" />
  <meta name="twitter:card" content="summary_large_image" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://unpkg.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; connect-src 'self' https://dnygudxhimjksxedzckl.supabase.co; font-src https://fonts.gstatic.com; img-src 'self' data:; object-src 'none'">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="/styles.css">
  </head>
<body>
  <header id="topbar" class="hide" role="banner">
    <div class="tb" aria-label="Barra superior">
      <div class="pill" aria-hidden="true">ProteeMVT</div>
      <div class="row" style="align-items:center">
        <span id="userBadge" class="muted" aria-live="polite"></span>
        <button id="btnProfile" class="btn btn-soft" type="button" aria-haspopup="dialog" aria-controls="profileModal">Tu perfil</button>
        <button id="btnHeaderLogout" class="btn" type="button">Salir</button>
      </div>
    </div>
  </header>

  <section id="hero-guest" class="hero" aria-labelledby="heroGuestTitle">
    <div class="wrap hero-pad">
      <div class="hero-grid">
        <div>
          <h1 id="heroGuestTitle" class="display">Nutrición simple, progreso real</h1>
          <p class="lead">Calcula tus macros, guarda tus metas diarias y registra tus comidas sin fricción.</p>
        </div>
        <aside class="card" aria-labelledby="accessTitle">
          <h2 id="accessTitle" style="margin:0 0 10px;font-size:22px;color:#0e3e34">Acceso</h2>
          <p class="muted" style="margin:0 0 10px">Elige una opción para continuar.</p>
          <div class="stack-10">
            <button id="btnOpenSignup" class="btn btn-primary" type="button">Regístrate</button>
            <button id="btnOpenLogin" class="btn btn-soft" type="button">Iniciar sesión</button>
          </div>
        </aside>
      </div>
    </div>
  </section>

  <main class="wrap" id="main">
    <section id="dashboard" class="hide" aria-label="Panel de usuario" style="margin-top:6px">
      <h2>Bienvenido</h2>
      <nav class="tabs" aria-label="Secciones del panel">
        <button data-tab="resumen" aria-current="page">Resumen</button>
        <button data-tab="calculadora">Calculadora de macros</button>
        <button data-tab="comidas">Comidas</button>
        <button data-tab="progreso">Progreso</button>
      </nav>

      <section id="resumen" class="stack-12">
        <div class="grid-3">
          <div class="card stack-12">
            <h3 style="margin:0">Metas de hoy</h3>
            <div class="stack-8">
              <div>
                <div class="row" style="justify-content:space-between"><strong>Calorías</strong><span id="sumCalGoal">—</span></div>
                <div class="bar" aria-hidden="true"><span id="barCal"></span></div>
                <div class="row" style="justify-content:space-between" aria-live="polite"><small class="muted">Consumidas</small><small id="sumCalIn">0</small></div>
              </div>
              <div>
                <div class="row" style="justify-content:space-between"><strong>Proteínas (g)</strong><span id="sumProtGoal">—</span></div>
                <div class="bar"><span id="barProt"></span></div>
                <div class="row" style="justify-content:space-between"><small class="muted">Consumidas</small><small id="sumProtIn">0</small></div>
              </div>
              <div>
                <div class="row" style="justify-content:space-between"><strong>Carbohidratos (g)</strong><span id="sumCarbGoal">—</span></div>
                <div class="bar"><span id="barCarb"></span></div>
                <div class="row" style="justify-content:space-between"><small class="muted">Consumidos</small><small id="sumCarbIn">0</small></div>
              </div>
              <div>
                <div class="row" style="justify-content:space-between"><strong>Grasas (g)</strong><span id="sumFatGoal">—</span></div>
                <div class="bar"><span id="barFat"></span></div>
                <div class="row" style="justify-content:space-between"><small class="muted">Consumidas</small><small id="sumFatIn">0</small></div>
              </div>
            </div>
          </div>
          <div class="card stack-12">
            <h3 style="margin:0">Atajos</h3>
            <div class="row">
              <button id="btnQuickAdd" class="btn btn-primary" type="button">+ Añadir comida</button>
              <button id="btnSetTodayTargets" class="btn" type="button">Aplicar metas guardadas</button>
            </div>
            <p class="muted">Consejo: guarda tus alimentos frecuentes para registrarlos en 2 clics.</p>
          </div>
          <div class="card stack-12">
            <h3 style="margin:0">Metas guardadas</h3>
            <div class="stack-8">
              <div class="row" style="gap:8px">
                <span class="pill">Mantenimiento</span>
                <span class="pill">Déficit leve</span>
                <span class="pill">Superávit leve</span>
              </div>
              <p class="muted">Puedes recalcular desde la Calculadora y guardar como preset.</p>
            </div>
          </div>
        </div>
      </section>

      <section id="calculadora" class="stack-16 hide" aria-labelledby="calcTitle">
        <h3 id="calcTitle" style="margin:0">Calculadora de macros</h3>
        <form id="macroForm" class="card stack-12" novalidate>
          <div class="grid-3">
            <div>
              <label for="sex">Sexo</label>
              <select id="sex" required>
                <option value="" disabled selected>Selecciona…</option>
                <option value="male">Masculino</option>
                <option value="female">Femenino</option>
              </select>
            </div>
            <div>
              <label for="age">Edad (años)</label>
              <input id="age" type="number" min="10" max="100" inputmode="numeric" placeholder="30" required />
            </div>
            <div>
              <label for="height">Estatura (cm)</label>
              <input id="height" type="number" min="120" max="230" inputmode="numeric" placeholder="175" required />
            </div>
            <div>
              <label for="weight">Peso (kg)</label>
              <input id="weight" type="number" min="30" max="250" step="0.1" inputmode="decimal" placeholder="75" required />
            </div>
            <div>
              <label for="activity">Actividad</label>
              <select id="activity" required>
                <option value="" disabled selected>Selecciona…</option>
                <option value="1.2">Sedentario</option>
                <option value="1.375">Ligero (1-3 d/sem)</option>
                <option value="1.55">Moderado (3-5 d/sem)</option>
                <option value="1.725">Intenso (6-7 d/sem)</option>
                <option value="1.9">Muy intenso (atleta)</option>
              </select>
            </div>
            <div>
              <label for="goal">Objetivo</label>
              <select id="goal" required>
                <option value="maintain">Mantener</option>
                <option value="deficit">Déficit (−10%)</option>
                <option value="surplus">Superávit (+10%)</option>
              </select>
            </div>
          </div>
          <div class="grid-3">
            <div>
              <label for="protein">Proteína (g/kg)</label>
              <input id="protein" type="number" step="0.1" min="1.4" max="2.6" value="2.0" required />
            </div>
            <div>
              <label for="fatPct">Grasa (% kcal)</label>
              <input id="fatPct" type="number" step="1" min="20" max="35" value="30" required />
            </div>
            <div class="row" style="align-items:flex-end">
              <button id="btnCalc" type="submit" class="btn btn-primary">Calcular</button>
              <button id="btnSavePreset" type="button" class="btn">Guardar preset</button>
            </div>
          </div>
          <p id="calcMsg" class="muted" role="status" aria-live="polite"></p>
          <div id="calcOut" class="grid-3 hide" aria-live="polite">
            <div class="card"><strong>Calorías día</strong><div id="outKcal" style="font-size:28px;margin-top:6px">—</div></div>
            <div class="card"><strong>Proteínas</strong><div id="outProt" style="font-size:28px;margin-top:6px">—</div><small class="muted">(4 kcal/g)</small></div>
            <div class="card"><strong>Grasas</strong><div id="outFat" style="font-size:28px;margin-top:6px">—</div><small class="muted">(9 kcal/g)</small></div>
            <div class="card"><strong>Carbohidratos</strong><div id="outCarb" style="font-size:28px;margin-top:6px">—</div><small class="muted">(4 kcal/g)</small></div>
            <div class="card"><strong>Fibra recomendada</strong><div id="outFiber" style="font-size:20px;margin-top:6px">—</div><small class="muted">14 g por cada 1000 kcal</small></div>
          </div>
        </form>
      </section>

      <section id="comidas" class="hide stack-16" aria-labelledby="foodsTitle">
        <h3 id="foodsTitle" style="margin:0">Registro de comidas</h3>
        <div class="grid-2">
          <form id="foodForm" class="card stack-12" novalidate>
            <h4 style="margin:0">Agregar alimento</h4>
            <div class="grid-2">
              <div>
                <label for="fName">Nombre</label>
                <input id="fName" type="text" placeholder="Yogurt griego natural" required />
              </div>
              <div>
                <label for="fBrand">Marca (opcional)</label>
                <input id="fBrand" type="text" placeholder="Laive" />
              </div>
            </div>
            <div class="grid-3">
              <div>
                <label for="fServing">Ración (g/ml)</label>
                <input id="fServing" type="number" min="1" step="1" placeholder="170" required />
              </div>
              <div>
                <label for="fKcal">Kcal x ración</label>
                <input id="fKcal" type="number" min="0" step="1" placeholder="120" required />
              </div>
              <div>
                <label for="fProtein">Prot (g)</label>
                <input id="fProtein" type="number" min="0" step="0.1" placeholder="17" required />
              </div>
              <div>
                <label for="fCarb">Carb (g)</label>
                <input id="fCarb" type="number" min="0" step="0.1" placeholder="6" required />
              </div>
              <div>
                <label for="fFat">Grasa (g)</label>
                <input id="fFat" type="number" min="0" step="0.1" placeholder="0" required />
              </div>
              <div>
                <label for="fFiber">Fibra (g)</label>
                <input id="fFiber" type="number" min="0" step="0.1" placeholder="0" />
              </div>
            </div>
            <div class="row" style="justify-content:space-between">
              <button id="btnSaveFood" type="submit" class="btn btn-primary">Guardar alimento</button>
              <div class="row">
                <label for="logQty">Registrar</label>
                <input id="logQty" type="number" min="0.25" step="0.25" value="1" style="width:90px" />
                <button id="btnLogFood" type="button" class="btn">+ al diario</button>
              </div>
            </div>
            <p id="foodMsg" class="muted" role="status" aria-live="polite"></p>
          </form>

          <div class="card stack-12">
            <div class="row" style="justify-content:space-between; align-items:center">
              <h4 style="margin:0">Tus alimentos guardados</h4>
              <input id="foodSearch" type="search" placeholder="Buscar…" style="max-width:260px" />
            </div>
            <table aria-label="Alimentos guardados">
              <thead>
                <tr><th>Alimento</th><th>Ración</th><th>Kcal</th><th>Prot</th><th>Carb</th><th>Grasa</th><th></th></tr>
              </thead>
              <tbody id="foodsTable"></tbody>
            </table>
          </div>
        </div>

        <div class="card stack-12">
          <div class="row" style="justify-content:space-between; align-items:center">
            <h4 style="margin:0">Diario de hoy <span id="todayLabel" class="muted"></span></h4>
            <div class="row">
              <button id="btnClearDay" class="btn" type="button">Limpiar</button>
            </div>
          </div>
          <table aria-label="Diario de hoy">
            <thead>
            <tr><th>Alimento</th><th>Ración</th><th>Cantidad</th><th>Kcal</th><th>Prot</th><th>Carb</th><th>Grasa</th><th></th></tr>
            </thead>
            <tbody id="dayTable"></tbody>
            <tfoot>
              <tr>
                <th class="right" colspan="3">Totales</th>
                <th id="totKcal">0</th><th id="totProt">0</th><th id="totCarb">0</th><th id="totFat">0</th>
                <th></th>
              </tr>
            </tfoot>
          </table>
        </div>
      </section>

      <section id="progreso" class="hide stack-12" aria-labelledby="progTitle">
        <h3 id="progTitle" style="margin:0">Progreso</h3>
        <div class="card stack-12">
          <p class="muted">Resumen semanal de adherencia (calorías consumidas vs meta).</p>
          <div id="adherence" class="stack-12"></div>
        </div>
      </section>

      <div class="center" style="margin-top:14px">
        <button class="btn" type="button" id="btnLogout">Cerrar sesión</button>
      </div>
    </section>
  </main>

  <!-- MODALES: Signup / Login / Perfil -->
  <div id="signupModal" class="hide" role="dialog" aria-modal="true" aria-labelledby="signupTitle">
    <section class="modal">
      <div class="card" style="max-width:460px;width:100%">
        <h2 id="signupTitle">Crear cuenta</h2>
        <div class="stack-12" style="margin-top:8px">
          <div>
            <label for="suEmail">Correo</label>
            <input id="suEmail" type="email" placeholder="tucorreo@ejemplo.com" autocomplete="email" required />
          </div>
          <div>
            <label for="suPass">Contraseña</label>
            <input id="suPass" type="password" placeholder="Mínimo 6 caracteres" autocomplete="new-password" required />
          </div>
        </div>
        <p id="suMsg" class="muted" style="margin-top:8px" role="status" aria-live="polite"></p>
        <div class="row" style="margin-top:12px;justify-content:flex-end">
          <button id="btnCloseSignup" class="btn" type="button">Cancelar</button>
          <button id="btnDoSignup" class="btn btn-primary" type="button">Crear cuenta</button>
        </div>
      </div>
    </section>
  </div>

  <div id="loginModal" class="hide" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
    <section class="modal">
      <div class="card" style="max-width:460px;width:100%">
        <h2 id="loginTitle">Iniciar sesión</h2>
        <div class="stack-12" style="margin-top:8px">
          <div>
            <label for="liEmail">Correo</label>
            <input id="liEmail" type="email" placeholder="tucorreo@ejemplo.com" autocomplete="email" required />
          </div>
          <div>
            <label for="liPass">Contraseña</label>
            <input id="liPass" type="password" placeholder="Tu contraseña" autocomplete="current-password" required />
          </div>
        </div>
        <p id="liMsg" class="muted" style="margin-top:8px" role="status" aria-live="polite"></p>
        <div class="row" style="margin-top:12px;justify-content:space-between">
          <button id="btnForgot" class="btn btn-soft" type="button">Olvidé mi contraseña</button>
          <div>
            <button id="btnCloseLogin" class="btn" type="button">Cancelar</button>
            <button id="btnDoLogin" class="btn btn-primary" type="button">Entrar</button>
          </div>
        </div>
      </div>
    </section>
  </div>

  <div id="profileModal" class="hide" role="dialog" aria-modal="true" aria-labelledby="profileTitle">
    <section class="modal">
      <div class="card" style="max-width:460px;width:100%">
        <h2 id="profileTitle">Tu perfil</h2>
        <p class="muted" style="margin-top:4px">Tu correo y nombre visible dentro de la app.</p>
        <div class="stack-12" style="margin-top:10px">
          <div>
            <label for="profEmail">Correo</label>
            <input id="profEmail" type="email" disabled />
          </div>
          <div>
            <label for="profName">Nombre visible</label>
            <input id="profName" type="text" placeholder="Tu nombre" />
          </div>
        </div>
        <div class="row" style="margin-top:12px;justify-content:flex-end">
          <button id="btnCloseProfile" class="btn" type="button">Cerrar</button>
          <button id="btnSaveProfile" class="btn btn-primary" type="button">Guardar</button>
        </div>
        <p id="profMsg" class="muted" style="margin-top:8px" role="status" aria-live="polite"></p>
      </div>
    </section>
  </div>

  <footer class="wrap" aria-label="Información legal">
    <p class="muted">© <span id="year"></span> ProteeMVT. Todos los derechos reservados.</p>
  </footer>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="/app.js" type="module"></script>
</body>
</html>
