<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ProteeMVT ‚Äî Calculadora Nutricional</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800&display=swap" rel="stylesheet" />
  <style>
    :root{--green:#2e8b57;--green-2:#3cb371;--bg:#f4fdf6}
    *{box-sizing:border-box}
    body{margin:0;font-family:'Nunito',sans-serif;background:var(--bg);color:#333}
    header{background:linear-gradient(90deg,var(--green),var(--green-2));color:#fff;padding:24px;text-align:center}
    header h1{margin:0;font-size:28px}
    header p{margin:8px 0 0;opacity:.9}
    .wrap{max-width:840px;margin:24px auto;padding:16px}
    .card{background:#fff;border-radius:16px;box-shadow:0 10px 24px rgba(0,0,0,.08);padding:22px}
    .row{display:grid;gap:16px}
    .row-2{grid-template-columns:1fr}
    @media(min-width:860px){.row-2{grid-template-columns:1.2fr .8fr}}
    h2{margin:0 0 12px;color:var(--green)}
    label{font-weight:700;font-size:14px}
    input{width:100%;padding:12px;border:1px solid #d9d9d9;border-radius:10px;font-size:15px}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;width:100%;padding:12px 14px;border-radius:10px;border:none;font-weight:800;cursor:pointer;transition:.2s}
    .btn-primary{background:var(--green-2);color:#fff}
    .btn-primary:hover{filter:brightness(.95)}
    .btn-google{background:#fff;border:1px solid #ddd}
    .muted{font-size:13px;color:#777}
    nav{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    nav a{padding:8px 10px;border-radius:8px;text-decoration:none;background:#eef8f0;color:#155b37;font-weight:700}
    .hide{display:none}
    .ok{color:#0a7a3d}
    .err{color:#b00020}
  </style>
</head>
<body>
  <header>
    <h1>ProteeMVT</h1>
    <p>Calcula tus macros, registra comidas y sigue tu progreso d√≠a a d√≠a.</p>
  </header>

  <div class="wrap">
    <div class="row row-2">
      <!-- Panel principal -->
      <section class="card">
        <div id="auth-section">
          <h2>Accede a tu cuenta</h2>
          <p class="muted">Crea tu cuenta con correo y contrase√±a.</p>
          <div class="row">
            <div>
              <label>Correo</label>
              <input id="emailInput" type="email" placeholder="tucorreo@ejemplo.com" required />
            </div>
            <div>
              <label>Contrase√±a</label>
              <input id="passInput" type="password" placeholder="M√≠nimo 6 caracteres" required />
            </div>
          </div>
          <div style="margin-top:12px" class="row">
            <button id="btnEmail" class="btn btn-primary">Ingresar / Crear cuenta</button>
          </div>
          <p id="msg" class="muted"></p>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="hide">
          <h2>Bienvenido üëã</h2>
          <nav>
            <a href="#" onclick="showSection('resumen')">üè† Resumen</a>
            <a href="#" onclick="showSection('comidas')">üçΩ Comidas</a>
            <a href="#" onclick="showSection('progreso')">üìä Progreso</a>
          </nav>
          <div id="resumen"><p>Aqu√≠ ver√°s tu balance de macros del d√≠a.</p></div>
          <div id="comidas" class="hide"><p>Aqu√≠ registrar√°s alimentos.</p></div>
          <div id="progreso" class="hide"><p>Aqu√≠ ver√°s tu progreso en gr√°ficos.</p></div>
          <button class="btn" onclick="logout()">Cerrar sesi√≥n</button>
        </div>
      </section>
    </div>
  </div>

  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <script>
    const { createClient } = supabase;
    const SUPABASE_URL = "https://dnygudxhjmjksxedzckl.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRueWd1ZHhoaW1qa3N4ZWR6Y2tsIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1Njc3MDk1MSwiZXhwIjoyMDcyMzQ2OTUxfQ.VC46pebXQqwwj7wSsH9WCeiEoFuGMXYcv3yTIgsYcxU";
    const sb = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const emailInput = document.getElementById("emailInput");
    const passInput = document.getElementById("passInput");
    const msg = document.getElementById("msg");

    // Registro / Login con email
    document.getElementById("btnEmail").onclick = async (e) => {
      e.preventDefault();
      msg.textContent = "";
      const email = emailInput.value.trim();
      const password = passInput.value.trim();
      if (!email || !password) {
        msg.textContent = "Completa correo y contrase√±a.";
        return;
      }
      const { data, error } = await sb.auth.signInWithPassword({ email, password });
      if (error) {
        const { error: signUpError } = await sb.auth.signUp({ email, password });
        if (signUpError) {
          msg.textContent = "Error: " + signUpError.message;
        } else {
          msg.textContent = "Cuenta creada. Revisa tu correo y confirma.";
        }
      } else {
        msg.textContent = "Sesi√≥n iniciada ‚úÖ";
        showDashboard();
      }
    };

    // Restaurar sesi√≥n tras confirmaci√≥n
    (async ()=>{
      const hash = window.location.hash || "";
      if (hash.includes("access_token") && hash.includes("refresh_token")) {
        const p = new URLSearchParams(hash.substring(1));
        await sb.auth.setSession({
          access_token: p.get("access_token"),
          refresh_token: p.get("refresh_token")
        });
        history.replaceState({}, document.title, window.location.pathname);
      }
      const { data: { user } } = await sb.auth.getUser();
      if (user) showDashboard();
    })();

    async function showDashboard(){
      document.getElementById("auth-section").classList.add("hide");
      document.getElementById("dashboard").classList.remove("hide");
    }

    async function logout(){
      await sb.auth.signOut();
      document.getElementById("auth-section").classList.remove("hide");
      document.getElementById("dashboard").classList.add("hide");
    }

    function showSection(sec){
      ["resumen","comidas","progreso"].forEach(id=>{
        document.getElementById(id).classList.toggle("hide", id!==sec);
      });
    }
  </script>
</body>
</html>
