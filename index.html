<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ProteeMVT ‚Äî Calculadora & Seguimiento</title>

  <!-- Tipograf√≠as redondeadas y modernas -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet" />

  <style>
    :root{
      --green:#2e8b57;            /* principal */
      --green-2:#3cb371;          /* acento */
      --green-3:#e9fbf1;          /* fondo claro */
      --ink:#21312b;              /* texto */
      --muted:#6c7c75;           /* texto suave */
      --card:#ffffff;            /* tarjeta */
      --ring:rgba(46,139,87,.25);
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0}
    body{
      font-family:'Poppins','Nunito',system-ui,-apple-system,Segoe UI,Roboto,Arial,Helvetica,sans-serif;
      color:var(--ink);
      background:
        radial-gradient(80vw 60vh at 80% 10%, rgba(60,179,113,.12), transparent 60%),
        radial-gradient(60vw 60vh at 0% 30%, rgba(46,139,87,.10), transparent 60%),
        linear-gradient(180deg, #f7fdf9 0%, var(--green-3) 100%);
      min-height:100dvh;
    }

    /* ====== HERO ====== */
    .hero{
      position:relative;
      overflow:hidden;
      padding: clamp(36px, 6vw, 72px) 16px 24px;
      text-align:center;
      background:
        radial-gradient(1200px 200px at 50% -50px, rgba(46,139,87,.55), rgba(60,179,113,.55)),
        linear-gradient(90deg, var(--green), var(--green-2));
      color:#fff;
    }
    .hero .badge{
      display:inline-block;
      font-weight:800;
      letter-spacing:.06em;
      text-transform:uppercase;
      background:rgba(255,255,255,.18);
      padding:8px 12px;border-radius:999px;font-size:12px
    }
    .hero h1{
      margin:14px auto 8px;
      font-weight:900;
      font-size: clamp(28px, 5.2vw, 52px);
      line-height:1.05;
      text-shadow:0 6px 28px rgba(0,0,0,.18);
    }
    .hero p{
      margin:8px auto 0;
      max-width:820px;
      font-size: clamp(14px, 2.5vw, 18px);
      opacity:.95;
    }

    /* ====== CONTENEDOR ====== */
    .wrap{max-width:980px;margin:24px auto;padding:0 16px 48px}

    /* ====== INFO BLOQUES ====== */
    .features{
      margin-top:18px;
      display:grid;gap:18px;
      grid-template-columns:1fr; 
    }
    @media(min-width:860px){ .features{grid-template-columns:repeat(3,1fr)} }
    .feat{
      background:var(--card);border-radius:20px;padding:18px;
      box-shadow:0 12px 30px rgba(24,71,52,.08);
      border:1px solid rgba(46,139,87,.08);
    }
    .feat h3{margin:0 0 8px;font-size:18px;color:var(--green)}
    .feat p{margin:0;color:var(--muted);font-size:14px}

    /* ====== AUTH CARD ====== */
    .grid-2{display:grid;gap:20px;grid-template-columns:1fr}
    @media(min-width:980px){.grid-2{grid-template-columns:1.1fr .9fr}}

    .card{
      background:var(--card);border-radius:22px;padding:22px;
      box-shadow:0 16px 36px rgba(24,71,52,.10);
      border:1px solid rgba(46,139,87,.10);
    }
    h2{margin:0 0 10px;font-size:22px;color:var(--green)}
    label{font-weight:700;font-size:13px}
    input{
      width:100%;padding:12px 14px;
      border:1px solid #dfe9e4;border-radius:12px;font-size:15px;outline:none;
      transition:border .15s, box-shadow .15s, transform .03s;
      background:#fff;
    }
    input:focus{border-color:var(--green-2);box-shadow:0 0 0 3px var(--ring)}
    .row{display:grid;gap:12px}
    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:8px;
      width:100%;padding:13px 16px;border-radius:12px;border:1px solid transparent;
      font-weight:800;cursor:pointer;transition:.18s;background:#fff;color:var(--ink)
    }
    .btn:active{transform:translateY(1px)}
    .btn-primary{background:var(--green-2);color:#fff}
    .btn-primary:hover{filter:brightness(.97)}
    .btn-soft{border-color:#e3efe9;background:#f7fcf9}
    .muted{color:var(--muted);font-size:13px}
    .ok{color:#127a44}
    .err{color:#b00020}

    nav.tabs{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0 14px}
    nav.tabs button{
      border:none;background:#eef8f0;color:#155b37;padding:8px 12px;border-radius:999px;
      font-weight:800;cursor:pointer
    }
    .hide{display:none}
    .center{text-align:center}
  </style>
</head>
<body>

  <!-- Hero -->
  <section class="hero">
    <span class="badge">protee mvt</span>
    <h1>Nutrici√≥n diaria, <br> simple y accionable</h1>
    <p>Calcula tus macros, registra lo que comes y sigue tu progreso. Dise√±o amable, claro y con foco en lo importante.</p>
  </section>

  <div class="wrap">

    <!-- Breve ‚Äúpor qu√©‚Äù con look editorial en tarjetas -->
    <div class="features">
      <div class="feat">
        <h3>üéØ Objetivo claro</h3>
        <p>Define tus metas y deja que la app traduzca todo a acciones simples: prote√≠nas, calor√≠as y h√°bitos.</p>
      </div>
      <div class="feat">
        <h3>üçΩÔ∏è Registro sin fricci√≥n</h3>
        <p>Agrega lo que comes y consulta valores. Cada d√≠a suma para tu progreso.</p>
      </div>
      <div class="feat">
        <h3>üìà Tu progreso</h3>
        <p>M√©tricas que s√≠ importan, con una vista limpia y motivadora.</p>
      </div>
    </div>

    <!-- Zona de autenticaci√≥n / dashboard -->
    <div class="grid-2" style="margin-top:22px">
      <!-- Panel de acceso -->
      <section class="card">
        <div id="auth-section">
          <h2>Accede a tu cuenta</h2>
          <p class="muted">Crea tu cuenta con correo y contrase√±a. Luego podr√°s guardar tus metas y comidas.</p>

          <div class="row" style="margin-top:10px">
            <div>
              <label>Correo</label>
              <input id="emailInput" type="email" placeholder="tucorreo@ejemplo.com" required />
            </div>
            <div>
              <label>Contrase√±a</label>
              <input id="passInput" type="password" placeholder="M√≠nimo 6 caracteres" required />
            </div>
          </div>

          <div class="row" style="margin-top:12px">
            <button id="btnEmail" class="btn btn-primary">Ingresar / Crear cuenta</button>
            <div style="display:flex;gap:10px;flex-wrap:wrap">
              <button id="btnResend" class="btn btn-soft" style="flex:1">Reenviar verificaci√≥n</button>
              <button id="btnForgot" class="btn btn-soft" style="flex:1">Olvid√© mi contrase√±a</button>
            </div>
          </div>

          <p id="msg" class="muted" style="margin-top:10px"></p>
        </div>

        <!-- Flujo de restablecimiento -->
        <div id="recovery-section" class="hide">
          <h2>Restablecer contrase√±a</h2>
          <p class="muted">Ingresa tu nueva contrase√±a para continuar.</p>
          <div class="row" style="margin-top:8px">
            <div>
              <label>Nueva contrase√±a</label>
              <input id="newPassInput" type="password" placeholder="Nueva contrase√±a" />
            </div>
          </div>
          <div style="margin-top:12px">
            <button id="btnSetNew" class="btn btn-primary">Guardar nueva contrase√±a</button>
          </div>
          <p id="recMsg" class="muted" style="margin-top:10px"></p>
        </div>

        <!-- Dashboard simple -->
        <div id="dashboard" class="hide">
          <h2>Bienvenido üëã</h2>
          <nav class="tabs">
            <button onclick="showSection('resumen')">üè† Resumen</button>
            <button onclick="showSection('comidas')">üçΩÔ∏è Comidas</button>
            <button onclick="showSection('progreso')">üìä Progreso</button>
          </nav>
          <div id="resumen"><p class="muted">Aqu√≠ ver√°s tu progreso y tus metas del d√≠a.</p></div>
          <div id="comidas" class="hide"><p class="muted">Pr√≥ximamente: registro y b√∫squeda de alimentos.</p></div>
          <div id="progreso" class="hide"><p class="muted">Pr√≥ximamente: gr√°ficos y tendencias.</p></div>
          <div class="center" style="margin-top:14px">
            <button class="btn" onclick="logout()">Cerrar sesi√≥n</button>
          </div>
        </div>
      </section>

      <!-- Lateral ‚Äúabout‚Äù corto -->
      <aside class="card" style="align-self:start">
        <h2>¬øQu√© es ProteeMVT?</h2>
        <p class="muted" style="margin-top:6px">
          Una calculadora y diario nutricional pensado para personas activas.
          Entra, define tus metas y registra tus comidas sin complicaciones.
        </p>
        <div class="feat" style="margin-top:10px">
          <h3>üß≠ Filosof√≠a</h3>
          <p>Menos ruido, m√°s enfoque en lo que suma cada d√≠a.</p>
        </div>
        <div class="feat" style="margin-top:10px">
          <h3>üîí Privacidad</h3>
          <p>Tus datos son tuyos. Autenticaci√≥n segura con Supabase.</p>
        </div>
      </aside>
    </div>
  </div>

  <!-- Supabase JS v2 -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    const { createClient } = supabase;

    /* ======= TU PROYECTO SUPABASE ======= */
    const SUPABASE_URL = "https://dnygudxhimjksxedzckl.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRueWd1ZHhmaW1qa3N4ZWR6Y2tsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY3NzA5NTEsImV4cCI6MjA3MjM0Njk1MX0.VysJaMOWnPpkg0ty4F68C5G_fI7gw8iabDL4SE_mzWI";
    const sb = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    /* ====== ELEMENTOS ====== */
    const emailInput = document.getElementById("emailInput");
    const passInput  = document.getElementById("passInput");
    const msg        = document.getElementById("msg");

    const recSec     = document.getElementById("recovery-section");
    const recMsg     = document.getElementById("recMsg");
    const newPassInput = document.getElementById("newPassInput");

    /* ====== HANDLERS ====== */

    // Login / Registro
    document.getElementById("btnEmail").onclick = async (e) => {
      e.preventDefault();
      msg.textContent = "";
      const email = emailInput.value.trim();
      const password = passInput.value.trim();
      if (!email || !password) {
        msg.textContent = "Completa correo y contrase√±a.";
        return;
      }

      // 1) Intentar login
      const login = await sb.auth.signInWithPassword({ email, password });
      if (!login.error) {
        msg.textContent = "Sesi√≥n iniciada ‚úÖ";
        showDashboard();
        return;
      }

      // 2) Si falla, intentar registro
      const signup = await sb.auth.signUp({ email, password });
      if (signup.error) {
        msg.textContent = "Error: " + signup.error.message;
        return;
      }

      // Confirmaci√≥n ON -> no hay session hasta confirmar por email
      if (signup.data?.user && !signup.data.session) {
        msg.textContent = "Cuenta creada. Revisa tu correo y confirma para entrar.";
      } else {
        msg.textContent = "Cuenta creada y sesi√≥n iniciada ‚úÖ";
        showDashboard();
      }
    };

    // Reenviar verificaci√≥n
    document.getElementById("btnResend").onclick = async (e) => {
      e.preventDefault();
      msg.textContent = "";
      const email = emailInput.value.trim();
      if (!email) { msg.textContent = "Escribe tu correo y pulsa Reenviar."; return; }
      const { error } = await sb.auth.resend({ type: "signup", email });
      msg.textContent = error ? ("No se pudo reenviar: " + error.message)
                              : "Te reenviamos el email de verificaci√≥n ‚úÖ";
    };

    // Olvid√© mi contrase√±a
    document.getElementById("btnForgot").onclick = async (e) => {
      e.preventDefault();
      msg.textContent = "";
      const email = emailInput.value.trim();
      if (!email) { msg.textContent = "Escribe tu correo primero."; return; }
      const { error } = await sb.auth.resetPasswordForEmail(email, {
        redirectTo: "https://calculadoraproteemvt.vercel.app"
      });
      msg.textContent = error ? ("No se pudo enviar: " + error.message)
                              : "Te enviamos un enlace para restablecer tu contrase√±a ‚úÖ";
    };

    // Guardar nueva contrase√±a en el flujo de recuperaci√≥n
    document.getElementById("btnSetNew").onclick = async () => {
      recMsg.textContent = "";
      const newPass = newPassInput.value.trim();
      if (!newPass) { recMsg.textContent = "Escribe la nueva contrase√±a."; return; }
      const { error } = await sb.auth.updateUser({ password: newPass });
      if (error) recMsg.textContent = "Error: " + error.message;
      else {
        recMsg.textContent = "Contrase√±a actualizada ‚úÖ";
        // Volver al login
        recSec.classList.add("hide");
        document.getElementById("auth-section").classList.remove("hide");
      }
    };

    // Cerrar sesi√≥n
    async function logout(){
      await sb.auth.signOut();
      document.getElementById("auth-section").classList.remove("hide");
      document.getElementById("dashboard").classList.add("hide");
      msg.textContent = "Sesi√≥n cerrada.";
    }

    // Mostrar secciones del dashboard
    function showSection(sec){
      ["resumen","comidas","progreso"].forEach(id=>{
        document.getElementById(id).classList.toggle("hide", id!==sec);
      });
    }

    // Mostrar dashboard si hay sesi√≥n
    async function showDashboard(){
      document.getElementById("auth-section").classList.add("hide");
      document.getElementById("recovery-section").classList.add("hide");
      document.getElementById("dashboard").classList.remove("hide");
    }

    /* ====== RESTAURAR SESI√ìN / FLUJOS DE EMAIL ====== */
    (async ()=>{
      const hash = window.location.hash || "";

      // Enlaces de verificaci√≥n / magic link traen tokens
      if (hash.includes("access_token") && hash.includes("refresh_token")) {
        const p = new URLSearchParams(hash.substring(1));
        await sb.auth.setSession({
          access_token: p.get("access_token"),
          refresh_token: p.get("refresh_token")
        });
        history.replaceState({}, document.title, window.location.pathname);
      }

      // Flujo de recuperaci√≥n de contrase√±a
      if (hash.includes("type=recovery")) {
        // El enlace trae una sesi√≥n temporal, mostramos form para nueva contrase√±a
        document.getElementById("auth-section").classList.add("hide");
        recSec.classList.remove("hide");
        return;
      }

      const { data: { user } } = await sb.auth.getUser();
      if (user) showDashboard();
    })();
  </script>
</body>
</html>
