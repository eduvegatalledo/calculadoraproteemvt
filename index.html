-- Habilita RLS y tablas
create table if not exists profiles (
  id uuid primary key references auth.users(id) on delete cascade,
  created_at timestamp with time zone default now(),
  display_name text
);
alter table profiles enable row level security;
create policy "own profile" on profiles
  for all using (auth.uid() = id) with check (auth.uid() = id);

create table if not exists meal_entries (
  id bigserial primary key,
  user_id uuid not null references auth.users(id) on delete cascade,
  date date not null,
  items jsonb not null,
  kcal numeric not null,
  protein numeric not null,
  carbs numeric not null,
  fat numeric not null,
  created_at timestamp with time zone default now()
);
alter table meal_entries enable row level security;
create policy "own meals" on meal_entries
  for all using (auth.uid() = user_id) with check (auth.uid() = user_id);

create table if not exists weight_logs (
  id bigserial primary key,
  user_id uuid not null references auth.users(id) on delete cascade,
  date date not null,
  weight numeric,
  body_fat numeric,
  created_at timestamp with time zone default now()
);
alter table weight_logs enable row level security;
create policy "own weights" on weight_logs
  for all using (auth.uid() = user_id) with check (auth.uid() = user_id);

create table if not exists user_foods (
  id bigserial primary key,
  user_id uuid not null references auth.users(id) on delete cascade,
  name text not null,
  per100 jsonb not null, -- {kcal,p,c,f}
  created_at timestamp with time zone default now()
);
alter table user_foods enable row level security;
create policy "own foods" on user_foods
  for all using (auth.uid() = user_id) with check (auth.uid() = user_id);
