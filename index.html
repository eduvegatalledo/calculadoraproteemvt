<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ProteeMVT ‚Äî Nutrici√≥n simple, progreso real</title>
  <meta name="description" content="ProteeMVT: calcula tus macros, registra lo que comes y mide tu avance." />
  <meta name="color-scheme" content="light" />
  <meta name="theme-color" content="#12d59a" />

  <!-- Social -->
  <meta property="og:title" content="ProteeMVT ‚Äî Nutrici√≥n simple, progreso real" />
  <meta property="og:description" content="Calcula tus macros, registra lo que comes y mide tu avance." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="/og-preview.png" />
  <meta property="og:locale" content="es_ES" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- Tipograf√≠as redondeadas -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600;700;800&family=Rubik+Rounded:wght@400;500;700;800&display=swap" rel="stylesheet" />

  <style>
    :root{
      --emerald:#10b981;   /* primario */
      --aqua:#32e6ff;      /* acento */
      --ink:#0b1a20;       /* texto principal */
      --ink-2:#355059;     /* texto secundario */
      --paper:#f8fffb;     /* fondo uniforme */
      --glass:#ffffff;     /* superficies */
      --stroke: rgba(12,130,94,.14);
      --ring: rgba(18,213,154,.22);
      --shadow: 0 14px 34px rgba(5,28,22,.08), 0 4px 14px rgba(5,28,22,.06);
      --radius-xl: 22px; --radius:16px; --radius-sm:12px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0}
    body{
      font-family:'Rubik Rounded','Poppins',system-ui,-apple-system,Segoe UI,Roboto,Arial,Helvetica,sans-serif;
      color:var(--ink);
      background: var(--paper);
      min-height:100dvh;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }

    .wrap{ max-width:1200px; margin:0 auto; padding:0 20px 72px; }

    /* Topbar (solo cuando hay sesi√≥n) */
    header#topbar{ position:sticky; top:0; z-index:30; }
    .tb{ max-width:1200px; margin:10px auto; padding:10px 16px; display:flex; align-items:center; justify-content:space-between; gap:12px; background:var(--glass); border:1px solid var(--stroke); border-radius:20px; box-shadow:var(--shadow); }
    .tb-actions{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .badge-email{color:#1c3b33;font-size:13px; opacity:.85}

    /* Botones & Inputs */
    .btn{ display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:12px 16px; border-radius:999px; border:1px solid var(--stroke); background:#ffffff; color:#0f2a23; font-weight:800; cursor:pointer; transition: transform .06s ease, box-shadow .18s ease, filter .18s ease; }
    .btn:active{ transform:translateY(1px) }
    .btn-primary{ background:linear-gradient(135deg,#16d39f,#0fb787); color:#04241b; border-color:transparent; box-shadow: 0 12px 26px rgba(16,185,129,.26), inset 0 -2px 0 rgba(0,0,0,.06); }
    .btn-primary:hover{ filter:brightness(1.03) }
    .btn-soft{ background:#f3fbf8; border-color:#e3f3ed }
    .btn[disabled]{ opacity:.6; cursor:not-allowed }

    label{ font-weight:700; font-size:13px; display:inline-block; margin-bottom:6px; letter-spacing:.2px }
    input{ width:100%; padding:15px 16px; border-radius:16px; border:1px solid #e5efea; background:#fff; font-size:16px; outline:none; transition:box-shadow .18s,border .18s,transform .03s; }
    input:focus{ border-color:var(--emerald); box-shadow:0 0 0 4px var(--ring); }

    /* Hero reorganizado: t√≠tulo a la izquierda, acceso a la derecha */
    .hero{ position:relative; color:#0a2a22; }
    .hero-pad{ padding: clamp(30px, 6vw, 60px) 20px; }
    .hero-grid{ display:grid; grid-template-columns:1fr; gap:20px }
    @media (min-width:980px){ .hero-grid{ grid-template-columns:1.2fr .8fr } }

    .display{ margin:8px 0 6px; line-height:1.02; font-weight:800; font-family:'Poppins','Rubik Rounded',sans-serif; font-size: clamp(38px, 7vw, 76px); color:#0c3e33; letter-spacing:.1px }
    .lead{ margin:10px 0 0; max-width:820px; font-size: clamp(16px, 2.2vw, 20px); color:#2f5b52; opacity:.98 }
    .subbrand{ margin:6px 0 2px; font-family:'Poppins','Rubik Rounded',sans-serif; color:#1c433a; opacity:.9 }

    /* Card gen√©rico */
    .card{ position:relative; background:var(--glass); border:1px solid var(--stroke); border-radius:var(--radius-xl); box-shadow:var(--shadow); padding:20px; }

    /* Acceso pulcro: s√≥lo dos botones */
    .access-card h2{ margin:0 0 10px; font-size:22px; color:#0e3e34 }
    .access-card .muted{ color:#40675e; font-size:13px; margin:0 0 10px }

    /* Tabs / dashboard */
    nav.tabs{ display:flex; gap:8px; flex-wrap:wrap; margin:10px 0 14px }
    nav.tabs button{ border:none; background:#ecfbf6; color:#0b4d3f; padding:10px 16px; border-radius:999px; font-weight:800; cursor:pointer; box-shadow:inset 0 0 0 1px #d8efe8; font-family:'Poppins','Rubik Rounded',sans-serif }

    .grid-3{ display:grid; gap:18px; grid-template-columns:1fr }
    @media (min-width:900px){ .grid-3{ grid-template-columns:repeat(3,1fr) } }
    .feat-card{ background:#ffffff; border:1px solid #e6f1ec; border-radius:18px; padding:18px; box-shadow:var(--shadow) }
    .feat-card h3{ margin:0 0 8px; font-size:18px; color:#0a372d; font-family:'Poppins','Rubik Rounded',sans-serif }
    .feat-card p{ margin:0; color:#335a52; font-size:14px }

    .hide{ display:none !important }
    .muted{ color:#40675e; font-size:13px }
    .center{ text-align:center }
    .stack-10{ display:grid; gap:10px }
    .stack-12{ display:grid; gap:12px }
    .row{ display:flex; gap:10px; flex-wrap:wrap }
  </style>
</head>
<body>

  <!-- Topbar (visible al iniciar sesi√≥n) -->
  <header id="topbar" class="hide" role="banner">
    <div class="tb">
      <div class="brand" aria-label="ProteeMVT" style="display:none"></div>
      <div class="tb-actions">
        <span id="userBadge" class="badge-email" aria-live="polite"></span>
        <button id="btnProfile" class="btn btn-soft" type="button" aria-haspopup="dialog" aria-controls="profileModal">Tu perfil</button>
        <button id="btnHeaderLogout" class="btn" type="button">Salir</button>
      </div>
    </div>
  </header>

  <!-- HERO: izquierda t√≠tulo, derecha acceso -->
  <section id="hero-guest" class="hero" aria-labelledby="heroGuestTitle">
    <div class="wrap hero-pad">
      <div class="hero-grid">
        <!-- Columna izquierda: t√≠tulo -->
        <div>
          <h1 id="heroGuestTitle" class="display">Nutrici√≥n simple, progreso real</h1>
          <p class="subbrand">ProteeMVT</p>
          <p class="lead">Calcula tus macros, registra lo que comes y mide tu avance.</p>
        </div>

        <!-- Columna derecha: acceso -->
        <aside class="card access-card" aria-labelledby="accessTitle">
          <h2 id="accessTitle">Acceso</h2>
          <p class="muted">Elige una opci√≥n para continuar.</p>
          <div class="stack-10">
            <button id="btnOpenSignup" class="btn btn-primary" type="button">Reg√≠strate aqu√≠</button>
            <button id="btnOpenLogin" class="btn btn-soft" type="button">Iniciar sesi√≥n</button>
          </div>
        </aside>
      </div>
    </div>
  </section>

  <!-- DASHBOARD (se muestra despu√©s de iniciar sesi√≥n) -->
  <main class="wrap" id="main">
    <section id="dashboard" class="hide" aria-label="Panel de usuario" style="margin-top:6px">
      <h2>Bienvenido üëã</h2>
      <nav class="tabs" aria-label="Secciones del panel">
        <button type="button" onclick="showSection('resumen')">üè† Resumen</button>
        <button type="button" onclick="showSection('comidas')">üçΩÔ∏è Comidas</button>
        <button type="button" onclick="showSection('progreso')">üìä Progreso</button>
      </nav>
      <div id="resumen"><p class="muted">Aqu√≠ ver√°s tu progreso y tus metas del d√≠a.</p></div>
      <div id="comidas" class="hide"><p class="muted">Pr√≥ximamente: registro y b√∫squeda de alimentos.</p></div>
      <div id="progreso" class="hide"><p class="muted">Pr√≥ximamente: gr√°ficos y tendencias.</p></div>
      <div class="center" style="margin-top:14px">
        <button class="btn" type="button" onclick="logout()">Cerrar sesi√≥n</button>
      </div>
    </section>

    <!-- Beneficios al final (opcional, puedes quitar si no los quieres) -->
    <section id="beneficios-final" class="grid-3" aria-label="Beneficios principales" style="margin-top:28px">
      <article class="feat-card"><h3>üéØ Objetivo claro</h3><p>Define metas y la app traduce a acciones simples: prote√≠nas, calor√≠as y h√°bitos.</p></article>
      <article class="feat-card"><h3>üçΩÔ∏è Registro sin fricci√≥n</h3><p>Agrega lo que comes en segundos y consulta valores clave sin perder el foco.</p></article>
      <article class="feat-card"><h3>üìà Progreso motivador</h3><p>Gr√°ficos limpios con m√©tricas que importan para sostener el h√°bito.</p></article>
    </section>
  </main>

  <!-- MODALES: Signup / Login -->
  <div id="signupModal" class="hide" role="dialog" aria-modal="true" aria-labelledby="signupTitle">
    <section class="wrap" style="position:fixed; inset:0; display:grid; place-items:center; background:rgba(2,16,13,.22)">
      <div class="card" style="max-width:460px;width:100%">
        <h2 id="signupTitle">Crear cuenta</h2>
        <div class="stack-12" style="margin-top:8px">
          <div>
            <label for="suEmail">Correo</label>
            <input id="suEmail" type="email" placeholder="tucorreo@ejemplo.com" autocomplete="email" />
          </div>
          <div>
            <label for="suPass">Contrase√±a</label>
            <input id="suPass" type="password" placeholder="M√≠nimo 6 caracteres" autocomplete="new-password" />
          </div>
        </div>
        <p id="suMsg" class="muted" style="margin-top:8px" role="status" aria-live="polite"></p>
        <div class="row" style="margin-top:12px;justify-content:flex-end">
          <button id="btnCloseSignup" class="btn" type="button">Cancelar</button>
          <button id="btnDoSignup" class="btn btn-primary" type="button">Crear cuenta</button>
        </div>
      </div>
    </section>
  </div>

  <div id="loginModal" class="hide" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
    <section class="wrap" style="position:fixed; inset:0; display:grid; place-items:center; background:rgba(2,16,13,.22)">
      <div class="card" style="max-width:460px;width:100%">
        <h2 id="loginTitle">Iniciar sesi√≥n</h2>
        <div class="stack-12" style="margin-top:8px">
          <div>
            <label for="liEmail">Correo</label>
            <input id="liEmail" type="email" placeholder="tucorreo@ejemplo.com" autocomplete="email" />
          </div>
          <div>
            <label for="liPass">Contrase√±a</label>
            <input id="liPass" type="password" placeholder="Tu contrase√±a" autocomplete="current-password" />
          </div>
        </div>
        <p id="liMsg" class="muted" style="margin-top:8px" role="status" aria-live="polite"></p>
        <div class="row" style="margin-top:12px;justify-content:space-between">
          <button id="btnForgot" class="btn btn-soft" type="button">Olvid√© mi contrase√±a</button>
          <div>
            <button id="btnCloseLogin" class="btn" type="button">Cancelar</button>
            <button id="btnDoLogin" class="btn btn-primary" type="button">Entrar</button>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Perfil -->
  <div id="profileModal" class="hide" role="dialog" aria-modal="true" aria-labelledby="profileTitle">
    <section class="wrap" style="position:fixed; inset:0; display:grid; place-items:center; background:rgba(2,16,13,.22)">
      <div class="card" style="max-width:460px;width:100%">
        <h2 id="profileTitle">Tu perfil</h2>
        <p class="muted" style="margin-top:4px">Tu correo y nombre visible dentro de la app.</p>
        <div class="stack-12" style="margin-top:10px">
          <div>
            <label for="profEmail">Correo</label>
            <input id="profEmail" type="email" disabled />
          </div>
          <div>
            <label for="profName">Nombre visible</label>
            <input id="profName" type="text" placeholder="Tu nombre" />
          </div>
        </div>
        <div class="row" style="margin-top:12px;justify-content:flex-end">
          <button id="btnCloseProfile" class="btn" type="button">Cerrar</button>
          <button id="btnSaveProfile" class="btn btn-primary" type="button">Guardar</button>
        </div>
        <p id="profMsg" class="muted" style="margin-top:8px" role="status" aria-live="polite"></p>
      </div>
    </section>
  </div>

  <footer class="wrap" aria-label="Informaci√≥n legal">
    <p class="muted">¬© <span id="year"></span> ProteeMVT. Todos los derechos reservados.</p>
  </footer>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    const { createClient } = supabase;

    const SUPABASE_URL = "https://dnygudxhimjksxedzckl.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRueWd1ZHhmaW1qa3N4ZWR6Y2tsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY3NzA5NTEsImV4cCI6MjA3MjM0Njk1MX0.VysJaMOWnPpkg0ty4F68C5G_fI7gw8iabDL4SE_mzWI";
    const sb = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const $ = (id)=>document.getElementById(id);
    const show = (id)=>$(id).classList.remove('hide');
    const hide = (id)=>$(id).classList.add('hide');

    function showSection(sec){ ["resumen","comidas","progreso"].forEach(id=>$(id).classList.toggle("hide", id!==sec)); }

    // ====== Modales helpers
    function openModal(id){ show(id); document.body.style.overflow='hidden'; }
    function closeModal(id){ hide(id); document.body.style.overflow=''; }

    // ====== Perfil API
    async function getUser(){ const { data:{ user } } = await sb.auth.getUser(); return user||null; }
    async function getProfile(userId){ const { data, error } = await sb.from('profiles').select('*').eq('id', userId).maybeSingle(); if(error){ console.error(error); return null; } return data||null; }
    async function ensureProfile(){ const user = await getUser(); if(!user) return null; let prof = await getProfile(user.id); if(!prof){ const { error } = await sb.from('profiles').insert({ id:user.id, display_name:user.email }); if(error) console.error(error); prof = await getProfile(user.id); openModal('profileModal'); } return prof; }

    function setLoggedUI({ user, profile }){
      show("topbar"); // header visible
      hide("hero-guest");
      show("dashboard");
      $("userBadge").textContent = user.email;
    }
    function setGuestUI(){ hide("topbar"); show("hero-guest"); hide("dashboard"); }

    async function afterLoginShowApp(){ const user = await getUser(); if(!user){ setGuestUI(); return; } const profile = await ensureProfile(); setLoggedUI({ user, profile }); }

    // ====== Botones acceso
    $("btnOpenSignup").onclick = ()=> openModal('signupModal');
    $("btnOpenLogin").onclick = ()=> openModal('loginModal');

    // ====== Signup
    $("btnCloseSignup").onclick = ()=> closeModal('signupModal');
    $("btnDoSignup").onclick = async ()=>{
      const email = ( $("suEmail").value || '' ).trim();
      const password = ( $("suPass").value || '' ).trim();
      const msg = $("suMsg"); msg.textContent='';
      if(!/.+@.+\..+/.test(email)){ msg.textContent='Ingresa un correo v√°lido.'; return; }
      if(password.length < 6){ msg.textContent='La contrase√±a debe tener al menos 6 caracteres.'; return; }
      const { data, error } = await sb.auth.signUp({ email, password });
      if(error){ msg.textContent = 'Error: '+error.message; return; }
      if(data?.user && !data.session){ msg.textContent='Cuenta creada. Revisa tu correo para confirmar.'; }
      else{ msg.textContent='Cuenta creada y sesi√≥n iniciada ‚úÖ'; closeModal('signupModal'); await afterLoginShowApp(); }
    };

    // ====== Login
    $("btnCloseLogin").onclick = ()=> closeModal('loginModal');
    $("btnDoLogin").onclick = async ()=>{
      const email = ( $("liEmail").value || '' ).trim();
      const password = ( $("liPass").value || '' ).trim();
      const msg = $("liMsg"); msg.textContent='';
      if(!/.+@.+\..+/.test(email)){ msg.textContent='Ingresa un correo v√°lido.'; return; }
      if(!password){ msg.textContent='Ingresa tu contrase√±a.'; return; }
      const { data, error } = await sb.auth.signInWithPassword({ email, password });
      if(error){ msg.textContent = 'No pudimos iniciar sesi√≥n: '+error.message; return; }
      msg.textContent='Sesi√≥n iniciada ‚úÖ';
      closeModal('loginModal');
      await afterLoginShowApp();
    };

    // ====== Forgot password
    $("btnForgot").onclick = async ()=>{
      const email = ( $("liEmail").value || '' ).trim();
      const msg = $("liMsg"); msg.textContent='';
      if(!/.+@.+\..+/.test(email)){ msg.textContent='Escribe el correo que usaste para registrarte.'; return; }
      const { error } = await sb.auth.resetPasswordForEmail(email, { redirectTo: window.location.origin });
      msg.textContent = error ? ('No se pudo enviar: '+error.message) : 'Te enviamos un enlace para restablecer tu contrase√±a ‚úÖ';
    };

    async function logout(){ await sb.auth.signOut(); setGuestUI(); }
    $("btnHeaderLogout").onclick = logout;

    // ====== Perfil
    $("btnProfile").onclick = async ()=>{ const user = await getUser(); if(!user) return; const profile = await getProfile(user.id); $("profEmail").value = user.email || ''; $("profName").value = profile?.display_name || ''; openModal('profileModal'); };
    $("btnCloseProfile").onclick = ()=> closeModal('profileModal');
    $("btnSaveProfile").onclick = async ()=>{ const user = await getUser(); if(!user) return; const display_name = ( $("profName").value || '' ).trim() || user.email; const { error } = await sb.from('profiles').upsert({ id:user.id, display_name }); $("profMsg").textContent = error ? ('Error: '+error.message) : 'Guardado ‚úÖ'; };

    // ====== Restaurar sesi√≥n desde enlaces de email
    (async ()=>{
      $("year").textContent = new Date().getFullYear();
      const hash = window.location.hash || "";
      if(hash.includes("access_token") && hash.includes("refresh_token")){
        const p = new URLSearchParams(hash.substring(1));
        await sb.auth.setSession({ access_token: p.get("access_token"), refresh_token: p.get("refresh_token") });
        history.replaceState({}, document.title, window.location.pathname);
      }
      if(hash.includes("type=recovery")){
        // Si viene desde email de recuperaci√≥n, abrir modal de login para que establezca nueva pass si el flujo lo pide
        openModal('loginModal');
      }
      const { data:{ user } } = await sb.auth.getUser();
      if(user) await afterLoginShowApp(); else setGuestUI();
    })();
  </script>
</body>
</html>
